<!DOCTYPE html>
<html th:fragment="default" th:replace="~{layout/site :: layout(_, ~{}, ~{::#content})}" xmlns:th="http://www.thymeleaf.org" lang="en">
<body>
    <div id="content">
        <div class="relative min-h-1/2">
            <div th:replace="~{this :: search}"></div>

            <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
                <div th:replace="~{this :: table}"></div>
            </div>
        </div>
    </div>
</body>
</html>

<section id="search" th:fragment="search" class="bg-gray-50 dark:bg-gray-900 flex items-center" xmlns:th="http://www.thymeleaf.org">
    <div class="w-full mb-2">
        <div class="relative bg-white shadow-md dark:bg-gray-800 sm:rounded-lg">
            <form th:object="${filter}" hx-post="/search" hx-target="table">
                <div class="flex flex-col items-center justify-between p-2 space-y-3 md:flex-row md:space-y-0 md:space-x-2">

                    <div th:replace="~{this :: search-inputs}"></div>

                    <div class="flex flex-col items-stretch justify-end flex-shrink-0 w-full space-y-2 md:w-auto md:flex-row md:space-y-0 md:items-center md:space-x-2">

                        <a th:href="@{/ciusky}"
                           class="inline-flex items-center justify-center w-full  text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                            <svg class="h-3.5 w-3.5 mr-2" fill="currentColor" viewbox="0 0 20 20"
                                 xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path clip-rule="evenodd" fill-rule="evenodd"
                                      d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"/>
                            </svg>
                            Add Ciusky
                        </a>

                        <div class="flex items-center w-full space-x-2 md:w-auto">
                            <div id="actionsDropdown"
                                 class="z-10 hidden bg-white divide-y divide-gray-100 rounded shadow w-44 dark:bg-gray-700 dark:divide-gray-600">
                                <ul class="py-1 text-sm text-gray-700 dark:text-gray-200"
                                    aria-labelledby="actionsDropdownButton">
                                    <li>
                                        <a href="#"
                                           class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Mass
                                            Edit</a>
                                    </li>
                                </ul>
                                <div class="py-1">
                                    <a href="#"
                                       class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Delete
                                        all</a>
                                </div>
                            </div>
                            <button id="actionsDropdownButton"
                                    data-dropdown-toggle="actionsDropdown"
                                    class="flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg md:w-auto focus:outline-none hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
                                    type="button">
                                <svg class="-ml-1 mr-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20"
                                     xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                                </svg>
                                Actions
                            </button>
                            <!-- Dropdown menu -->
                            <div id="filterDropdown"
                                 class="z-10 hidden w-48 p-3 bg-white rounded-lg shadow dark:bg-gray-700">
                                <h6 class="mb-3 text-sm font-medium text-gray-900 dark:text-white">
                                    Category
                                </h6>
                                <ul class="space-y-2 text-sm" aria-labelledby="dropdownDefault">
                                    <li th:each="checkbox : ${ciuskyTypes}" class="flex items-center">
                                        <input th:value="${checkbox.id}"
                                               th:field="*{types}"
                                               hx-post="/search"
                                               hx-trigger="click"
                                               type="checkbox"
                                               class="w-4 h-4 bg-gray-100 border-gray-300 rounded text-primary-600 focus:ring-primary-500 dark:focus:ring-primary-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500"/>
                                        <label th:text="${checkbox.descr}"
                                               class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100"></label>
                                    </li>
                                </ul>
                            </div>
                            <button id="filterDropdownButton"
                                    data-dropdown-toggle="filterDropdown"
                                    class="flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg md:w-auto focus:outline-none hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
                                    type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
                                     class="w-4 h-4 mr-2 text-gray-400" viewbox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                          d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                                          clip-rule="evenodd"/>
                                </svg>
                                Filter
                                <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20"
                                     xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path clip-rule="evenodd" fill-rule="evenodd"
                                          d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/>
                                </svg>
                            </button>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>

<div id="search-inputs" th:fragment="search-inputs" th:object="${filter}" hx-swap-oob="true" class="w-full" xmlns:th="http://www.thymeleaf.org">
    <div class="flex items-center space-x-2">
        <label for="simple-search" class="sr-only">Search</label>
        <div class="relative w-full">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                     fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                          clip-rule="evenodd"/>
                </svg>
            </div>
            <input id="simple-search" th:field="*{text}" hx-post="/search" hx-target="table"
                   hx-trigger="input changed delay:400ms"
                   type="text"
                   autocomplete="off"
                   class="block w-full p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                   placeholder="Search Title or Description">
        </div>

        <label for="tag-search" class="sr-only">Tags</label>
        <div class="relative w-full">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                     fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                          clip-rule="evenodd"/>
                </svg>
            </div>
            <input id="tag-search" th:field="*{tags}" hx-post="/search" hx-target="table"
                   hx-trigger="input changed delay:400ms"
                   type="text"
                   autocomplete="off"
                   class="block w-full p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                   placeholder="Search Tags">

            <div th:replace="~{components/field-error :: input-icon('tags')}"></div>
        </div>
    </div>
</div>

<table th:fragment="table" class="csk-table" xmlns:th="http://www.thymeleaf.org">
    <thead>
    <tr>
        <th scope="col">ID</th>
        <th scope="col">Title</th>
        <th scope="col">Description</th>
        <th scope="col">Type</th>
        <th scope="col">Quality</th>
        <th scope="col">Paid</th>
        <th scope="col">Value</th>
        <th scope="col">Tags</th>
        <th scope="col">Images</th>
        <th scope="col"></th>
    </tr>
    </thead>
    <!-- @see hx-confirm" -->
    <tbody hx-target="closest tr" hx-swap="outerHTML swap:500ms">
    <tr th:each="item : ${listCiusky}">
        <td th:text="${item.id}"></td>
        <td th:text="${item.title}" class="max-w-md" ></td>
        <td class="max-w-md">
            <p th:text="${item.description}" class="text-ellipsis overflow-hidden"></p>
        </td>
        <td th:text="${item.typeDescription}"></td>
        <td>
            <div th:replace="~{components/star-rating.html :: view(value=${item.quality})}"></div>
        </td>
        <td th:text="${item.paidPrice}"></td>
        <td th:text="${item.marketPrice}"></td>
        <td>
            <div class="flex flex-wrap gap-2 py-1 max-w-md">
                <span th:class="'whitespace-nowrap csk-tag-'+ ${tagColor}"
                      th:each="tag : ${item.tags}"
                      th:text="|${tag.key}: ${tag.value}|"
                      th:with="tagColor=${@templateUtils.getColor(tag.key)}"></span>
            </div>
        </td>
        <td>
            <div class="flex gap-2 whitespace-nowrap py-1">
                <img th:each="uuid, iter: ${item.uuidImages}" th:if="${iter.index} < 3"
                     th:src="@{/ciusky/image/{uuid}?thumbnail=true(uuid=${uuid})}"
                     loading="lazy" class="w-10 h-10 rounded-sm" alt="Thumbnail"/>
                <div th:text="'+' + ${#lists.size(item.uuidImages) - 3}"
                     th:if="${#lists.size(item.uuidImages)} > 3"
                     class="w-10 h-10 rounded-sm bg-gray-200 flex items-center justify-center text-sm font-medium"></div>
            </div>
        </td>
        <td class="align-middle text-center whitespace-nowrap py-1">
            <a th:href="@{/ciusky/{id}(id=${item.id})}"
               class="inline-flex items-center gap-2 align-middle">
                <div th:replace="~{components/icon.html :: icon('edit', 'w-6 h-6 text-gray-100')}"></div>
            </a>
            <a href="#" th:hx-delete="@{/ciusky/{id}(id=${item.id})}"
               class="inline-flex items-center gap-2 align-middle">
                <div th:replace="~{components/icon.html :: icon('delete', 'w-6 h-6 text-red-500')}"></div>
            </a>
        </td>
    </tr>
    </tbody>
</table>

